# WT9011 BLE Sensor Examples

Набор примеров для работы с датчиком WT9011 через Bluetooth Low Energy (BLE).

## Структура проекта

```
examples/
├── example_data.py          # Простой пример получения данных
├── example_functions.py     # Интерактивный пример с командами
├── example_ui.py           # GUI приложение с полным функционалом
└── README.md               # Этот файл

lib/
├── ble_manager.py          # Модуль для работы с BLE
├── sensor_commands.py      # Команды управления датчиком
├── sensor_parser.py        # Парсер данных датчика
└── README.md               # Документация библиотеки
```

## Зависимости

Установите необходимые пакеты:

```bash
pip install bleak rich pyqt5 pyqtgraph qasync asyncio
```

## Примеры использования

### 1. example_data.py - Базовый пример

Простой пример для быстрого старта:
- Сканирование BLE устройств
- Подключение к выбранному датчику
- Получение и отображение данных в реальном времени
- Базовые команды (обнуление, калибровка)

**Запуск:**
```bash
python example_data.py
```

**Возможности:**
- Автоматическое сканирование устройств
- Выбор устройства из списка
- Отображение данных с временными метками
- Команды: `q` (выход), `z` (обнуление), `c` (калибровка)

### 2. example_functions.py - Расширенный функционал

Интерактивный пример с полным набором команд:
- Все команды управления датчиком
- Настройка параметров в реальном времени
- Управление режимами работы

**Запуск:**
```bash
python example_functions.py
```

**Доступные команды:**
- `z` - Обнуление положения
- `c` - Калибровка датчика
- `s` - Спящий режим
- `w` - Пробуждение
- `save` - Сохранить настройки
- `reset` - Заводской сброс
- `rate [число]` - Установить частоту (1-100 Гц)
- `accel on/off` - Включить/выключить акселерометр
- `gyro on/off` - Включить/выключить гироскоп
- `mag on/off` - Включить/выключить магнитометр
- `q` - Выход

### 3. example_ui.py - GUI приложение

Полнофункциональное графическое приложение:
- Современный интерфейс с вкладками
- Графики в реальном времени
- Панель управления с кнопками
- Экспорт данных в JSON/CSV
- Логирование событий

**Запуск:**
```bash
python example_ui.py
```

**Функции интерфейса:**

#### Вкладка "Данные датчика"
- Отображение текущих значений акселерометра, гироскопа и углов
- График в реальном времени для данных акселерометра
- Автоматическое обновление каждые 20мс

#### Вкладка "Управление"
- **Основные команды:** Обнуление, калибровка, сохранение, сброс
- **Управление питанием:** Спящий режим, пробуждение
- **Настройки частоты:** Установка частоты обновления (1-100 Гц)
- **Управление датчиками:** Включение/выключение акселерометра и гироскопа

#### Вкладка "Логи"
- Журнал всех событий с временными метками
- Информация о подключении/отключении
- Ошибки и предупреждения

#### Экспорт данных
- **JSON формат:** Полная история данных с метаданными
- **CSV формат:** Табличные данные для анализа в Excel/Python

## Описание данных

Датчик WT9011 возвращает следующие данные:

### Акселерометр (g)
- `accel.x` - Ускорение по оси X
- `accel.y` - Ускорение по оси Y  
- `accel.z` - Ускорение по оси Z

### Гироскоп (°/с)
- `gyro.x` - Угловая скорость по оси X
- `gyro.y` - Угловая скорость по оси Y
- `gyro.z` - Угловая скорость по оси Z

### Углы поворота (°)
- `angle.roll` - Крен (-180° до +180°)
- `angle.pitch` - Тангаж (-90° до +90°)
- `angle.yaw` - Рыскание (-180° до +180°)

## Протокол команд

Все команды имеют формат: `[0xFF, 0xAA, КОД_КОМАНДЫ, ПАРАМЕТР]`

### Основные команды
- `0x52, 0x00` - Обнуление положения
- `0x01, 0x00` - Калибровка
- `0x06, 0x00` - Спящий режим
- `0x06, 0x01` - Пробуждение
- `0x00, 0x00` - Сохранить настройки
- `0x03, 0x00` - Заводской сброс

### Управление датчиками
- `0x10, 0x01/0x00` - Включить/выключить акселерометр
- `0x11, 0x01/0x00` - Включить/выключить гироскоп
- `0x15, [1-100]` - Установить частоту возврата данных

## Формат данных

Входящие данные имеют структуру:
```
[0x55, 0x61, AX_L, AX_H, AY_L, AY_H, AZ_L, AZ_H, 
 GX_L, GX_H, GY_L, GY_H, GZ_L, GZ_H, 
 ROLL_L, ROLL_H, PITCH_L, PITCH_H, YAW_L, YAW_H]
```

Где:
- `AX/AY/AZ` - значения акселерометра (знаковые 16-бит)
- `GX/GY/GZ` - значения гироскопа (знаковые 16-бит)
- `ROLL/PITCH/YAW` - углы поворота (знаковые 16-бит)

## Преобразование значений

### Акселерометр
```python
accel_g = raw_value / 32768 * 16  # ±16g диапазон
```

### Гироскоп
```python
gyro_dps = raw_value / 32768 * 2000  # ±2000°/с диапазон
```

### Углы
```python
angle_deg = raw_value / 32768 * 180  # ±180° диапазон
```

## Советы по использованию

### Калибровка
1. Разместите датчик на ровной поверхности
2. Запустите команду калибровки (`c`)
3. Не двигайте датчик в течение 10-15 секунд
4. Сохраните настройки командой `save`

### Обнуление
- Используйте команду `z` для установки текущего положения как нулевого
- Полезно для определения относительных углов поворота

### Частота обновления
- Для экономии энергии используйте низкую частоту (1-10 Гц)
- Для быстрых движений используйте высокую частоту (50-100 Гц)
- По умолчанию: 50 Гц

### Подключение
- Убедитесь, что Bluetooth включен
- Датчик должен быть в режиме сопряжения
- Расстояние до датчика не более 10 метров

## Устранение неполадок

### Датчик не найден при сканировании
- Проверьте, что датчик включен
- Убедитесь, что он не подключен к другому устройству
- Перезапустите Bluetooth на компьютере

### Нет данных после подключения
- Проверьте, что датчик не в спящем режиме
- Отправьте команду пробуждения (`w`)
- Убедитесь, что датчики включены

### Некорректные данные
- Выполните калибровку датчика
- Проверьте стабильность Bluetooth соединения
- Убедитесь, что датчик не подвергается магнитным помехам

### Ошибки подключения
- Закройте все другие приложения, использующие Bluetooth
- Перезапустите приложение
- Проверьте совместимость версии Bluetooth (требуется BLE 4.0+)

## Лицензия

Этот код предоставляется "как есть" для образовательных и исследовательских целей.

## Поддержка

При возникновении проблем:
1. Проверьте версии установленных пакетов
2. Убедитесь в правильности подключения датчика
3. Изучите логи ошибок в GUI приложении